<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>After Dark: Final Edition</title>
    <style>
        :root {
            --bg: #050505;
            --card: #141414;
            --text: #dfe6e9;
            --blue: #0984e3; /* Male */
            --pink: #e84393; /* Female */
            --gold: #fdcb6e; /* Warning */
            --green: #00b894;
            --red: #ff7675;
        }

        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Helvetica Neue', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; margin: 0; padding: 20px; overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .container { width: 100%; max-width: 450px; text-align: center; margin-top: 10px; }
        .hidden { display: none; }

        /* --- SETUP STYLES --- */
        .setup-box {
            background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: left;
        }
        
        input[type="text"] {
            width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #444;
            background: #222; color: white; font-size: 1rem; margin-bottom: 15px; text-align: center;
        }

        .gender-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .gender-btn {
            flex: 1; padding: 12px; border: 1px solid #444; background: #222; color: #888;
            border-radius: 10px; cursor: pointer; font-weight: bold; text-align: center;
        }
        .gender-btn.selected-m { background: var(--blue); color: white; border-color: var(--blue); }
        .gender-btn.selected-f { background: var(--pink); color: white; border-color: var(--pink); }

        .checkbox-row {
            display: flex; align-items: center; justify-content: space-between;
            background: #222; padding: 12px; border-radius: 10px; margin-bottom: 10px;
        }
        .checkbox-row label { font-size: 0.9rem; }
        input[type="checkbox"] { transform: scale(1.5); accent-color: var(--green); }

        /* --- GAME STYLES --- */
        .header-info { display: flex; justify-content: space-between; font-size: 0.8rem; color: #888; margin-bottom: 5px; width: 100%; }
        .progress-bar { width: 100%; height: 6px; background: #333; border-radius: 10px; margin-bottom: 20px; }
        .progress-fill { height: 100%; width: 0%; background: var(--green); transition: width 0.5s, background-color 0.5s; }

        .game-card {
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border-radius: 25px; padding: 30px 20px; min-height: 350px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border: 1px solid #333; margin-bottom: 20px; position: relative;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        /* WARNING MODE STYLES */
        .game-card.warning { border: 2px solid var(--gold); box-shadow: 0 0 20px rgba(253, 203, 110, 0.2); }
        .warning-badge {
            background: var(--gold); color: black; font-weight: 800; padding: 8px 20px;
            border-radius: 50px; font-size: 0.9rem; margin-bottom: 15px; display: none;
            text-transform: uppercase;
        }

        .level-tag {
            position: absolute; top: 15px; right: 15px; font-size: 0.7rem; color: #555; border: 1px solid #333; padding: 3px 8px; border-radius: 10px;
        }

        .names { font-size: 1.3rem; font-weight: 800; text-transform: uppercase; margin-bottom: 15px; color: #fff; }
        .text { font-size: 1.4rem; line-height: 1.4; font-weight: 500; }
        
        .btn-group { display: flex; gap: 10px; width: 100%; margin-top: 10px; }
        button {
            padding: 18px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
            width: 100%; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.5); color: white;
        }
        .btn-main { background: linear-gradient(45deg, #0984e3, #6c5ce7); }
        .btn-skip { background: #636e72; }
        .btn-force { background: var(--gold); color: black; }
        
        button:active { transform: scale(0.97); }

    </style>
</head>
<body>

<div class="container">

    <div id="setupScreen">
        <div class="setup-box">
            <h2 style="margin-top:0">ADD PLAYER</h2>
            <input type="text" id="pName" placeholder="Name">
            
            <div class="gender-row">
                <div class="gender-btn" id="btnM" onclick="selectGender('M')">MALE</div>
                <div class="gender-btn" id="btnF" onclick="selectGender('F')">FEMALE</div>
            </div>

            <div class="checkbox-row">
                <label>Open to Same Sex?</label>
                <input type="checkbox" id="pSameSex">
            </div>
            
            <div class="checkbox-row">
                <label>OK with Nudity?</label>
                <input type="checkbox" id="pNudity">
            </div>

            <div class="checkbox-row">
                <label>OK with Pain?</label>
                <input type="checkbox" id="pPain">
            </div>
            
            <button class="btn-main" onclick="addPlayer()">ADD TO GAME</button>
            <div id="pList" style="margin-top:15px; color:#888; font-size:0.8rem;">Players: 0</div>
            <button onclick="startGame()" style="margin-top:15px; background:#2d3436">START GAME</button>
        </div>
    </div>

    <div id="gameScreen" class="hidden">
        
        <div class="header-info">
            <span id="heatLabel">WARM UP</span>
            <span id="turnLabel">Turn 0</span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="heatBar"></div></div>

        <div class="game-card" id="cardDisplay">
            <div class="level-tag" id="lvlTag">LVL 1</div>
            <div class="warning-badge" id="warnBadge">⚠️ BRO... NO.</div>
            <div class="names" id="namesDisplay">ARE YOU READY?</div>
            <div class="text" id="textDisplay">
                The game tracks compatibility.<br><br>
                If an incompatible pair matches, the card will turn GOLD. The group can decide to Skip or Do It.
            </div>
        </div>

        <div id="normalControls">
            <button class="btn-main" onclick="nextTurn()">DRAW CARD</button>
        </div>

        <div id="warningControls" class="btn-group hidden">
            <button class="btn-skip" onclick="nextTurn()">SKIP (NO)</button>
            <button class="btn-force" onclick="forceAction()">DO IT (YES)</button>
        </div>

    </div>

</div>

<script>
    /* --- CONFIGURATION --- */
    const TURNS_TO_L2 = 10;
    const TURNS_TO_L3 = 20;

    /* --- STATE --- */
    let players = [];
    let turnCount = 0;
    let selectedGender = null;
    let usedCardIds = new Set(); // Memory system to prevent repeats

    /* --- FULL DATABASE (60+ CARDS) --- */
    const db = [
        // --- LEVEL 1 (Warm Up - Verbal/Safe) ---
        { id: 101, lvl: 1, flags: ['safe'], text: "{A}, what is the first thing you noticed about {B}?" },
        { id: 102, lvl: 1, flags: ['safe'], text: "{A}, stare into {B}'s eyes for 60s without looking away." },
        { id: 103, lvl: 1, flags: ['safe'], text: "{A}, describe your favorite type of kiss to the group." },
        { id: 104, lvl: 1, flags: ['safe'], text: "{A}, whisper a genuine compliment into {B}'s ear." },
        { id: 105, lvl: 1, flags: ['safe'], text: "{A}, what is a non-sexual act that turns you on?" },
        { id: 106, lvl: 1, flags: ['safe'], text: "{A}, send a risky text to {B}. {B} cannot read it yet." },
        { id: 107, lvl: 1, flags: ['safe'], text: "{B} asks {A} a personal question. {A} must answer truthfully." },
        { id: 108, lvl: 1, flags: ['safe'], text: "{A}, do you prefer lights on or off? Explain why." },
        { id: 109, lvl: 1, flags: ['safe'], text: "{A}, rate {B}'s outfit on a scale of 1-10." },
        { id: 110, lvl: 1, flags: ['safe'], text: "{A}, tell the group about your best kiss ever." },
        { id: 111, lvl: 1, flags: ['safe'], text: "{A}, show the group the last photo in your camera roll." },
        { id: 112, lvl: 1, flags: ['safe'], text: "{A}, moan {B}'s name as if you were climaxing." },
        { id: 113, lvl: 1, flags: ['safe'], text: "{A}, hold hands with {B} for the next round." },
        { id: 114, lvl: 1, flags: ['safe'], text: "{A}, describe {B}'s vibe in three words." },
        { id: 115, lvl: 1, flags: ['safe'], text: "{A}, who in this room do you think is the best kisser?" },
        { id: 116, lvl: 1, flags: ['safe'], text: "{A}, wink at {B} across the room. Make it sexy." },
        { id: 117, lvl: 1, flags: ['safe'], text: "{A}, bite your lip while looking at {B}'s lips." },
        { id: 118, lvl: 1, flags: ['safe'], text: "{A}, confess a fantasy you have never told anyone." },
        { id: 119, lvl: 1, flags: ['safe'], text: "{A}, let {B} smell your neck closely." },
        { id: 120, lvl: 1, flags: ['safe'], text: "{A}, tell {B} what color underwear you are wearing." },

        // --- LEVEL 2 (Foreplay - Touch/Tease) ---
        { id: 201, lvl: 2, flags: ['safe'], text: "{A}, give {B} a neck massage for 1 minute." },
        { id: 202, lvl: 2, flags: ['safe'], text: "{A}, sit on {B}'s lap for the next 2 turns." },
        { id: 203, lvl: 2, flags: ['safe'], text: "{A}, run your fingers through {B}'s hair while looking at them." },
        { id: 204, lvl: 2, flags: ['fluids'], text: "{A}, kiss {B} on the cheek or neck (no lips)." },
        { id: 205, lvl: 2, flags: ['safe'], text: "{A}, trace the outline of {B}'s lips with your finger." },
        { id: 206, lvl: 2, flags: ['fluids'], text: "{A}, lick a drop of a drink off {B}'s finger." },
        { id: 207, lvl: 2, flags: ['safe'], text: "{A}, let {B} hold your waist from behind for a minute." },
        { id: 208, lvl: 2, flags: ['pain'], text: "{A}, hold {B}'s wrists behind their back gently." },
        { id: 209, lvl: 2, flags: ['pain'], text: "{A}, bite {B}'s earlobe gently." },
        { id: 210, lvl: 2, flags: ['safe'], text: "{A}, kiss {B}'s hand while making eye contact." },
        { id: 211, lvl: 2, flags: ['fluids'], text: "{A}, blow gently on {B}'s neck." },
        { id: 212, lvl: 2, flags: ['safe'], text: "{A}, place your hand on {B}'s inner thigh (over clothes)." },
        { id: 213, lvl: 2, flags: ['safe'], text: "{A}, let {B} guide your hand to somewhere on their body." },
        { id: 214, lvl: 2, flags: ['fluids'], text: "{A}, kiss {B} anywhere except the lips." },
        { id: 215, lvl: 2, flags: ['nudity'], text: "{A}, flash a body part of your choice to {B}." },
        { id: 216, lvl: 2, flags: ['pain'], text: "{A}, pull {B}'s hair gently while whispering to them." },
        { id: 217, lvl: 2, flags: ['safe'], text: "{A}, grind slowly on {B}'s lap for 10 seconds." },
        { id: 218, lvl: 2, flags: ['fluids'], text: "{A}, run an ice cube down {B}'s neck using your mouth." },
        { id: 219, lvl: 2, flags: ['safe'], text: "{A}, blindfold {B} and touch them using only your fingertips." },
        { id: 220, lvl: 2, flags: ['nudity'], text: "{A}, take off one accessory (belt, tie, socks, jewelry)." },

        // --- LEVEL 3 (Deep End - Action) ---
        { id: 301, lvl: 3, flags: ['nudity'], text: "{A}, take off your shirt/top." },
        { id: 302, lvl: 3, flags: ['fluids'], text: "{A}, French kiss {B} for 20 seconds." },
        { id: 303, lvl: 3, flags: ['pain'], text: "{A}, spank {B}. {B} decides how hard." },
        { id: 304, lvl: 3, flags: ['nudity'], text: "{A}, perform a 30-second striptease for {B}." },
        { id: 305, lvl: 3, flags: ['fluids'], text: "{A}, take a body shot off {B} (stomach or neck)." },
        { id: 306, lvl: 3, flags: ['pain'], text: "{A}, leave a mark (hickey/scratch) on {B}." },
        { id: 307, lvl: 3, flags: ['safe'], text: "{A} & {B}, go into the closet/bathroom for 7 minutes. No rules." },
        { id: 308, lvl: 3, flags: ['nudity'], text: "{A}, swap underwear with {B}." },
        { id: 309, lvl: 3, flags: ['fluids'], text: "{A}, kiss {B}'s inner thigh." },
        { id: 310, lvl: 3, flags: ['nudity'], text: "{A}, let {B} take a sexy photo of you (delete after showing)." },
        { id: 311, lvl: 3, flags: ['safe'], text: "{A}, simulate sex positions with {B} (clothes on)." },
        { id: 312, lvl: 3, flags: ['safe'], text: "{A}, put your hand down {B}'s pants for 30 seconds." },
        { id: 313, lvl: 3, flags: ['pain'], text: "{A}, choke {B} lightly while kissing them." },
        { id: 314, lvl: 3, flags: ['nudity'], text: "{A}, allow {B} to remove one item of your clothing." },
        { id: 315, lvl: 3, flags: ['safe'], text: "{A}, give {B} a lap dance." },
        { id: 316, lvl: 3, flags: ['fluids'], text: "{A}, suck {B}'s finger or thumb." },
        { id: 317, lvl: 3, flags: ['nudity'], text: "{A}, show the group your bare ass." },
        { id: 318, lvl: 3, flags: ['pain'], text: "{A}, slap {B}'s face lightly." },
        { id: 319, lvl: 3, flags: ['fluids'], text: "{A}, make out with {B} for 1 minute." },
        { id: 320, lvl: 3, flags: ['nudity'], text: "{A}, remain topless for the next 3 rounds." }
    ];

    /* --- SETUP FUNCTIONS --- */
    function selectGender(g) {
        selectedGender = g;
        document.getElementById('btnM').className = g === 'M' ? 'gender-btn selected-m' : 'gender-btn';
        document.getElementById('btnF').className = g === 'F' ? 'gender-btn selected-f' : 'gender-btn';
    }

    function addPlayer() {
        const name = document.getElementById('pName').value.trim();
        if (!name || !selectedGender) return alert("Please enter Name & Select Gender");

        players.push({
            name: name,
            gender: selectedGender,
            sameSex: document.getElementById('pSameSex').checked,
            nudity: document.getElementById('pNudity').checked,
            pain: document.getElementById('pPain').checked
        });

        // Reset inputs
        document.getElementById('pName').value = "";
        selectGender(null);
        document.getElementById('btnM').className = 'gender-btn';
        document.getElementById('btnF').className = 'gender-btn';
        document.getElementById('pSameSex').checked = false;
        document.getElementById('pNudity').checked = false;
        document.getElementById('pPain').checked = false;
        
        document.getElementById('pList').innerText = `Players: ${players.length}`;
    }

    function startGame() {
        if (players.length < 2) return alert("Need 2+ players!");
        document.getElementById('setupScreen').classList.add('hidden');
        document.getElementById('gameScreen').classList.remove('hidden');
    }

    /* --- GAME ENGINE --- */
    function nextTurn() {
        // Reset UI from Warning state
        resetUI();
        
        turnCount++;
        updateHeat();

        // 1. DETERMINE HEAT LEVEL
        const heatLvl = turnCount > TURNS_TO_L3 ? 3 : (turnCount > TURNS_TO_L2 ? 2 : 1);

        // 2. PICK PLAYERS (Random Pair)
        let p1 = players[Math.floor(Math.random() * players.length)];
        let p2 = players[Math.floor(Math.random() * players.length)];
        while (p1 === p2) p2 = players[Math.floor(Math.random() * players.length)];

        // 3. PICK CARD
        // Filter: Heat Lvl + Nudity + Pain + Not Used
        const validCards = db.filter(c => {
            if (usedCardIds.has(c.id)) return false; // Burned card
            if (c.lvl > heatLvl) return false; // Too hot
            
            // Allow level 1 cards in level 2 occasionally? No, let's keep it progressing.
            
            // Check Limits
            if (c.flags.includes('nudity') && (!p1.nudity || !p2.nudity)) return false;
            if (c.flags.includes('pain') && (!p1.pain || !p2.pain)) return false;
            
            return true;
        });

        const cardEl = document.getElementById('cardDisplay');
        cardEl.style.transform = "scale(0.95)";

        setTimeout(() => {
            if (validCards.length === 0) {
                // Deck Empty or Limits too strict
                document.getElementById('namesDisplay').innerText = "RESHUFFLING";
                document.getElementById('textDisplay').innerText = "No valid cards left for this heat/limit combo! Reshuffling memory...";
                usedCardIds.clear();
            } else {
                const card = validCards[Math.floor(Math.random() * validCards.length)];
                
                // Burn the card so it doesn't repeat
                usedCardIds.add(card.id);

                const text = card.text.replace(/{A}/g, p1.name).replace(/{B}/g, p2.name);
                document.getElementById('namesDisplay').innerText = `${p1.name} & ${p2.name}`;
                document.getElementById('textDisplay').innerText = text;
                document.getElementById('lvlTag').innerText = "LVL " + card.lvl;

                // 4. CHECK COMPATIBILITY
                if (!checkCompatibility(p1, p2)) {
                    triggerWarning(p1, p2);
                }
            }
            cardEl.style.transform = "scale(1)";
        }, 100);
    }

    function checkCompatibility(p1, p2) {
        // Mixed Gender -> OK
        if (p1.gender !== p2.gender) return true;
        
        // Same Gender -> Check Box
        if (p1.gender === p2.gender) {
            if (p1.sameSex && p2.sameSex) return true;
            return false;
        }
        return true;
    }

    function triggerWarning(p1, p2) {
        const cardEl = document.getElementById('cardDisplay');
        cardEl.classList.add('warning');
        
        const badge = document.getElementById('warnBadge');
        badge.style.display = 'block';
        
        if (p1.gender === 'M') badge.innerText = "⚠️ BRO... NO.";
        else badge.innerText = "⚠️ INCOMPATIBLE PAIR"; // Girls get a softer message or generic

        document.getElementById('normalControls').classList.add('hidden');
        document.getElementById('warningControls').classList.remove('hidden');
    }

    function forceAction() {
        document.getElementById('normalControls').classList.remove('hidden');
        document.getElementById('warningControls').classList.add('hidden');
        document.getElementById('cardDisplay').classList.remove('warning');
        document.getElementById('warnBadge').style.display = 'none';
        alert("Action Confirmed. Good luck!");
    }

    function resetUI() {
        document.getElementById('normalControls').classList.remove('hidden');
        document.getElementById('warningControls').classList.add('hidden');
        document.getElementById('cardDisplay').classList.remove('warning');
        document.getElementById('warnBadge').style.display = 'none';
        document.getElementById('cardDisplay').classList.remove('warning');
    }

    function updateHeat() {
        let pct = (turnCount / TURNS_TO_L3) * 100;
        if(pct > 100) pct = 100;
        
        const bar = document.getElementById('heatBar');
        bar.style.width = pct + "%";
        
        const label = document.getElementById('heatLabel');
        document.getElementById('turnLabel').innerText = "Turn " + turnCount;

        if (turnCount > TURNS_TO_L3) {
            label.innerText = "MAXIMUM HEAT";
            label.style.color = "var(--red)";
            bar.style.backgroundColor = "var(--red)";
        } else if (turnCount > TURNS_TO_L2) {
            label.innerText = "FOREPLAY";
            label.style.color = "var(--gold)";
            bar.style.backgroundColor = "var(--gold)";
        }
    }
</script>
</body>
</html>

